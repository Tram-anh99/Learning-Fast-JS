name: ðŸš€ Deploy Preview

on:
     pull_request:
          branches: [main]

jobs:
     preview:
          name: ðŸ”® Build Preview
          runs-on: ubuntu-latest

          defaults:
               run:
                    working-directory: ./Frontend

          steps:
               - name: ðŸ“¥ Checkout code
                 uses: actions/checkout@v4

               - name: ðŸ“¦ Setup Node.js
                 uses: actions/setup-node@v4
                 with:
                      node-version: "20"
                      cache: "npm"
                      cache-dependency-path: Frontend/package-lock.json

               - name: ðŸ“š Install dependencies
                 run: npm ci

               - name: ðŸ”¨ Build for preview
                 run: npm run build

               - name: ðŸ“Š Build size report
                 run: |
                      echo "## ðŸ“Š Build Size Report" >> $GITHUB_STEP_SUMMARY
                      echo "" >> $GITHUB_STEP_SUMMARY
                      echo "| File | Size |" >> $GITHUB_STEP_SUMMARY
                      echo "|------|------|" >> $GITHUB_STEP_SUMMARY
                      du -sh dist/* | while read size file; do
                        echo "| $file | $size |" >> $GITHUB_STEP_SUMMARY
                      done
                      echo "" >> $GITHUB_STEP_SUMMARY
                      echo "**Total:** $(du -sh dist | cut -f1)" >> $GITHUB_STEP_SUMMARY

               - name: ðŸ’¬ Comment PR
                 uses: actions/github-script@v7
                 with:
                      script: |
                           github.rest.issues.createComment({
                             issue_number: context.issue.number,
                             owner: context.repo.owner,
                             repo: context.repo.repo,
                             body: 'âœ… **Build Preview Ready!**\n\nðŸš€ Build completed successfully.\nðŸ“¦ Artifacts uploaded.\n\n---\n*WebGIS NÃ´ng Nghiá»‡p Smart*'
                           })
